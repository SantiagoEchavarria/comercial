<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="es" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<head th:replace="~{plantillas/principal :: head}"></head>
<style>
  .list-group-item {
    padding-top: 5px;
    padding-bottom: 5px;
  }
</style>

<body>
<header th:replace="~{plantillas/principal :: header}"></header>

<div class="container py-4">
  <div class="card bg-light">
    <div class="card-header">
      <h3 class="text-secondary" th:text="${titulo}"></h3>
    </div>

    <div class="card-body shadow-lg p-3">

      <!-- Botón de facturar -->
      <h4 class="card-title text-end" sec:authorize="hasRole('ROLE_ADMIN')">
        <a th:href="@{/comercial/facturanueva/} + ${cliente.id}" title="facturar"
           class="btn btn-outline-success btn-sm">facturar</a>&nbsp;
      </h4>

      <!-- Imagen -->
      <img style="max-width: 20%" class="img-thumbnail rounded float-start"
           th:src="@{/uploads/cliente/} + ${cliente.imagen}"
           th:if="${#strings.length(cliente.imagen) > 0}"/>

      <!-- Info del cliente -->
      <ul class="list-group">
        <li class="list-group-item"><b>Tipo identificación: </b><i th:text="${cliente.tipoIdentificacion}"></i></li>
        <li class="list-group-item"><b>Identificación: </b><i th:text="${cliente.identificacion}"></i></li>
        <li class="list-group-item"><b>Teléfono: </b><i th:text="${cliente.telefono}"></i></li>
        <li class="list-group-item"><b>Dirección: </b><i th:text="${cliente.direccion}"></i></li>
        <li class="list-group-item"><b>Nombre completo: </b><i th:text="${cliente.nombreCompleto}"></i></li>
        <li class="list-group-item"><b>Fecha de ingreso: </b>
          <i th:text="${#temporals.format(cliente.fechaIngreso, 'dd/MM/yyyy')}"></i>
        </li>
        <li class="list-group-item"><b>Correo electrónico: </b><i th:text="${cliente.correoElectronico}"></i></li>
        <li class="list-group-item"><b>Capacidad de crédito: $</b>
          <i th:text="${#numbers.formatInteger(cliente.capacidadCredito, 1, 'COMMA')}"></i>
        </li>
      </ul>

      <!-- ===================== TABS ===================== -->
      <ul class="nav nav-tabs mt-4" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
          <button class="nav-link active" id="facturas-tab" data-bs-toggle="tab"
                  data-bs-target="#facturas" type="button" role="tab"
                  aria-controls="facturas" aria-selected="true">
            Facturas
          </button>
        </li>

        <li class="nav-item" role="presentation">
          <button class="nav-link" id="documentos-tab" data-bs-toggle="tab"
                  data-bs-target="#documentos" type="button" role="tab"
                  aria-controls="documentos" aria-selected="false">
            Documentos
          </button>
        </li>
      </ul>

      <div class="tab-content mt-3" id="myTabContent">

        <!-- ===================== TAB FACTURAS ===================== -->
        <div class="tab-pane fade show active" id="facturas" role="tabpanel" aria-labelledby="facturas-tab">

          <h4 class="text-secondary">Facturas</h4>

          <table th:if="${not #lists.isEmpty(cliente.facturas)}"
                 class="table table-striped table-bordered table-sm">

            <thead class="table-dark">
            <tr>
              <th class="text-center">Nro. Factura</th>
              <th class="ps-2">Descripción</th>
              <th class="text-center">Fecha</th>
              <th class="text-center">Subtotal</th>
              <th class="text-center">Acciones</th>
            </tr>
            </thead>

            <tbody>
            <tr th:each="fact : ${cliente.facturas}">
              <td class="text-center" th:text="${fact.nroFactura}"></td>
              <td class="ps-2" th:text="${fact.descripcion}"></td>
              <td class="text-center" th:text="${fact.fechaVenta}"></td>
              <td class="text-end pe-2"
                  th:text="${#numbers.formatDecimal(fact.subtotal, 0, 'COMMA', 1, 'POINT')}"></td>

              <td class="text-center">
                <a th:href="@{/comercial/reporte-factura-pdf/} + ${fact.nroFactura}">
                  <i class="bi-file-earmark-pdf" style="color: darkred"></i>
                </a>

                <a th:href="@{/comercial/facturaconsultar/} + ${fact.nroFactura}" title="consultar">
                  <i class="bi-eye" style="color: mediumblue"></i></a>&nbsp;

                <a th:href="@{/comercial/facturaeliminar/} + ${fact.nroFactura}"
                   onclick="return confirm('Seguro de eliminar la factura ?')" title="eliminar factura">
                  <i class="bi-trash" style="color: indianred"></i></a>
              </td>
            </tr>
            </tbody>
          </table>

          <div th:text="'No hay facturas para el cliente ' + ${cliente.nombreCompleto}"
               th:if="${#lists.isEmpty(cliente.facturas)}"
               class="alert alert-info mt-3"></div>
        </div>

        <!-- ===================== TAB DOCUMENTOS ===================== -->
        <div class="tab-pane fade" id="documentos" role="tabpanel" aria-labelledby="documentos-tab">
   
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h4 class="text-secondary">Documentos</h4>
            <a th:href="@{'/comercial/documentonuevo/' + ${cliente.id}}"
               class="btn btn-outline-primary btn-sm">+ agregar documento</a>
          </div>

          <table th:if="${not #lists.isEmpty(cliente.documentos)}"
                 class="table table-bordered table-striped table-sm">

            <thead class="table-dark">
            <tr>
              <th>Descripción</th>
              <th>Archivo</th>
              <th>Fecha carga</th>
              <th class="text-center">Acciones</th>
            </tr>
            </thead>

            <tbody>
            <tr th:each="doc : ${cliente.documentos}">
              <td th:text="${doc.descripcion}"></td>

              <td>
                <a th:href="@{/uploads/documento/} + ${doc.archivo}" target="_blank">
                  <i class="bi-paperclip"></i> Archivo
                </a>
              </td>

              <td th:text="${#dates.format(doc.fechaCarga, 'dd/MM/yyyy HH:mm')}"></td>


              <td class="text-center">
                <a th:href="@{/uploads/documento/} + ${doc.archivo}" title="consultar">
                  <i class="bi-eye" style="color: mediumblue"></i>
                </a>&nbsp;
                <a th:href="@{/comercial/documentoeliminar/} + ${doc.id}"
                   onclick="return confirm('Seguro de eliminar el documento?')" title="eliminar">
                  <i class="bi-trash" style="color: indianred"></i>
                </a>
              </td>
            </tr>
            </tbody>

          </table>

          <div th:if="${#lists.isEmpty(cliente.documentos)}"
               class="alert alert-info mt-3">
            No hay documentos cargados para este cliente.
          </div>

        </div>
      </div>

      <!-- Regresar -->
      <div class="text-right mt-3 text-end">
        <a th:href="@{/comercial/clienteslistar}" class="btn btn-sm btn-light"
           style="color: green; font-size: 1.1em;">&laquo; regresar</a>
      </div>

    </div>
  </div>
</div>

<footer th:replace="~{plantillas/principal :: footer}"></footer>

</body>
</html>
